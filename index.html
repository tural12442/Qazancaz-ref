<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Referans Sistemi</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Inter', sans-serif;
  background: linear-gradient(135deg, #3b82f6, #8b5cf6, #ec4899);
  color: white;
  min-height: 100vh;
  margin: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  text-align: center;
  animation: bgMove 10s infinite alternate;
  background-size: 400% 400%;
}
@keyframes bgMove {
  0% {background-position: 0% 50%;}
  100% {background-position: 100% 50%;}
}
.container {
  background: rgba(255,255,255,0.1);
  border-radius: 16px;
  padding: 30px;
  width: 90%;
  max-width: 400px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.3);
  backdrop-filter: blur(10px);
}
h1 {
  font-size: 24px;
  margin-bottom: 10px;
}
p {color: #e0e7ff;}
.ref-link {
  background: rgba(255,255,255,0.15);
  padding: 10px;
  border-radius: 10px;
  font-size: 14px;
  word-break: break-all;
  cursor: pointer;
  transition: 0.3s;
}
.ref-link:hover { background: rgba(255,255,255,0.25); }
button {
  margin-top: 15px;
  padding: 10px 20px;
  border: none;
  border-radius: 10px;
  background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
  color: white;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
}
button:hover { transform: scale(1.05); }
</style>
</head>
<body>

<div class="container">
  <h1>üë• Referans Sistemi</h1>
  <p>D…ôv…ôt et v…ô h…ôr dost √º√ß√ºn <b>0.10 ‚Çº</b> qazan!</p>
  <div id="refLink" class="ref-link">Y√ºkl…ônir...</div>
  <p style="margin-top:10px;">D…ôv…ôt sayƒ±: <b id="refCount">0</b></p>
  <p>Balans: <b id="balance">0.0000 ‚Çº</b></p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

// üî• Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyD0dnb927FbT2LjZf06hxB6lBX2JaBdevc",
  authDomain: "qazanc-az-64da7.firebaseapp.com",
  projectId: "qazanc-az-64da7",
  storageBucket: "qazanc-az-64da7.firebasestorage.app",
  messagingSenderId: "1069574349445",
  appId: "1:1069574349445:web:b815928eca716f89617fec",
  measurementId: "G-Y5ZHFYLGMC"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// üß† Telegram m…ôlumatlarƒ±nƒ± al
const tg = window.Telegram?.WebApp;
tg?.expand();

let userId = localStorage.getItem("userId");
let userName = "ƒ∞stifad…ô√ßi";
let invitedBy = "";

// Telegramdan g…ôl…ôn UID v…ô start_param
try {
  const user = tg?.initDataUnsafe?.user;
  if (user?.id) {
    userId = user.id.toString();
    userName = user.first_name;
    localStorage.setItem("userId", userId);
  }
  if (tg?.initDataUnsafe?.start_param) {
    invitedBy = tg.initDataUnsafe.start_param;
    localStorage.setItem("invitedBy", invitedBy);
  }
} catch(e) {
  console.log("Telegram m…ôlumatƒ± tapƒ±lmadƒ±:", e);
}

// ∆èg…ôr localStorage-da varsa, ordan g√∂t√ºr
invitedBy = invitedBy || localStorage.getItem("invitedBy") || "";

if (!userId) {
  userId = Math.floor(Math.random() * 1000000000).toString();
  localStorage.setItem("userId", userId);
}

const refLink = `https://t.me/reklampaybot?startapp=${userId}`;
const refEl = document.getElementById("refLink");
refEl.textContent = refLink;
refEl.onclick = () => {
  navigator.clipboard.writeText(refLink);
  alert("üìã Referans linkiniz kopyalandƒ±!");
};

// üß© Firebased…ô qeydiyyat v…ô bonus
async function initUser() {
  const userRef = doc(db, "users", userId);
  const snap = await getDoc(userRef);

  // Yeni istifad…ô√ßi …ôlav…ô et
  if (!snap.exists()) {
    await setDoc(userRef, {
      balance: 0,
      referral_count: 0,
      invited_by: invitedBy
    });

    // ∆èg…ôr bu istifad…ô√ßi kimins…ô linkind…ôn g…ôlibs…ô
    if (invitedBy && invitedBy !== userId) {
      const inviterRef = doc(db, "users", invitedBy);
      await updateDoc(inviterRef, {
        referral_count: increment(1),
        balance: increment(0.1)
      }).catch(() => {});
    }
  }

  // M…ôlumatƒ± g√∂st…ôr
  const userData = (await getDoc(userRef)).data();
  document.getElementById("balance").textContent = `${userData.balance.toFixed(4)} ‚Çº`;
  document.getElementById("refCount").textContent = userData.referral_count;
}

initUser();
</script>
</body>
</html>
