<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Qazanc AZ</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="//libtl.com/sdk.js" data-zone="10024800" data-sdk="show_10024800"></script>

<style>
:root {
  --neon1:#3b82f6;
  --neon2:#8b5cf6;
  --neon3:#ec4899;
  --card-bg:rgba(255,255,255,0.1);
  --glass:rgba(255,255,255,0.08);
  --text-light:#e2e8f0;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{
  font-family:'Inter',sans-serif;
  background:linear-gradient(135deg,var(--neon1),var(--neon2),var(--neon3));
  background-size:400% 400%;
  animation:bgMove 12s ease infinite;
  color:#fff;min-height:100vh;
  user-select:none;-webkit-user-select:none;
  -webkit-tap-highlight-color:transparent;
}
@keyframes bgMove{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}
.container{max-width:480px;margin:auto;padding:20px;padding-top:70px;}
.page{display:none;animation:fadeIn .4s ease;}
.page.active{display:block;}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
.balance-card{
  background:var(--glass);
  border-radius:20px;padding:22px;
  margin-bottom:40px;
  box-shadow:0 4px 25px rgba(0,0,0,.4);
  backdrop-filter:blur(10px);
  text-align:center;
  border:1px solid rgba(255,255,255,0.15);
}
.balance-card h3{font-size:15px;color:#c7d2fe;}
.balance-card .amount{font-size:34px;font-weight:700;margin-top:5px;}
.balance-card .usd{font-size:15px;color:#86efac;margin-top:4px;}

.ad-card,.task-card{
  background:var(--glass);
  border-radius:20px;
  padding:26px;
  text-align:center;
  box-shadow:0 6px 28px rgba(0,0,0,.4);
  backdrop-filter:blur(12px);
  border:1px solid rgba(255,255,255,0.15);
}
.ad-card h2,.task-card h2{
  font-size:22px;
  color:#f0f9ff;
  text-shadow:0 0 6px rgba(255,255,255,0.4);
}
.ad-card p{margin:6px 0;color:#e2e8f0;font-size:15px;}
.stats{display:flex;justify-content:space-around;margin-top:16px;}
.stat{background:rgba(255,255,255,.1);border-radius:12px;padding:10px 20px;}
.stat span{display:block;font-size:19px;font-weight:700;}
.stat label{font-size:13px;color:#cbd5e1;}
.progress{height:8px;background:rgba(255,255,255,0.2);border-radius:6px;overflow:hidden;margin-top:16px;}
.progress-fill{height:100%;background:#22d3ee;width:0%;transition:width .4s;}
.ad-btn,.task-card button,.form button,.method{
  width:100%;
  margin-top:18px;
  padding:15px;
  font-size:17px;
  font-weight:700;
  border:none;
  border-radius:14px;
  color:#fff;
  cursor:pointer;
  position:relative;
  overflow:hidden;
  transition:0.3s;
  background:linear-gradient(90deg,#3b82f6,#8b5cf6,#ec4899);
  background-size:300% 300%;
  animation:glowMove 6s infinite alternate;
  box-shadow:0 0 15px rgba(59,130,246,0.6);
}
.ad-btn:hover,.task-card button:hover,.form button:hover,.method:hover{
  transform:scale(1.03);
  box-shadow:0 0 25px rgba(236,72,153,0.8);
}
@keyframes glowMove{
  0%{background-position:0% 50%;}
  100%{background-position:100% 50%;}
}
#adBtn:disabled{opacity:0.5;cursor:not-allowed;}
#msg{text-align:center;margin-top:10px;font-size:15px;color:#fff8b0;}

.method-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px;margin-top:10px;}
.method{background:rgba(255,255,255,0.12);}
.form{display:none;margin-top:18px;}

/* üí° Burda input dizaynƒ± yax≈üƒ±la≈üdƒ±rƒ±lƒ±b */
.form input{
  width:100%;
  padding:12px;
  margin-top:8px;
  border:none;
  border-radius:10px;
  background:rgba(255,255,255,.18);
  color:#fff;
  font-size:16px;
  font-weight:600;
  outline:none;
  transition:0.2s;
}
.form input::placeholder{
  color:#e2e8f0;
  opacity:0.8;
}
.form input:focus{
  background:rgba(255,255,255,0.25);
  box-shadow:0 0 10px rgba(255,255,255,0.3);
}

.alert{display:none;margin-top:10px;padding:10px;border-radius:10px;font-weight:700;text-align:center;}
.success{background:#16a34a;}
.error{background:#ef4444;}

.menu{
  position:fixed;bottom:15px;left:50%;transform:translateX(-50%);
  width:92%;display:flex;justify-content:space-around;
  background:rgba(17,24,39,0.9);
  padding:10px;border-radius:20px;
  box-shadow:0 6px 20px rgba(0,0,0,.6);
}
.menu button{
  flex:1;margin:0 4px;padding:10px;
  border:none;border-radius:12px;
  background:rgba(255,255,255,.07);
  color:#fff;font-weight:700;
  transition:0.3s;
}
.menu button.active{
  background:linear-gradient(90deg,#3b82f6,#8b5cf6);
  box-shadow:0 0 10px rgba(139,92,246,0.7);
}
.copy-msg{font-size:13px;color:#86efac;margin-top:8px;display:none;}
</style>
</head>
<body>

<div class="container">

  <!-- Reklam s…ôhif…ôsi -->
  <div id="adsPage" class="page active">
    <div class="balance-card">
      <h3>Balansƒ±nƒ±z</h3>
      <div class="amount"><span id="balance">0.0000</span> ‚Çº</div>
      <div class="usd">‚âà $<span id="usd">0.00</span></div>
    </div>

    <div class="ad-card">
      <h2>G√ºnd…ôlik Reklamlar</h2>
      <p>H…ôr reklama g√∂r…ô <b>0.0020 ‚Çº</b> qazanƒ±n</p>
      <div class="stats">
        <div class="stat"><span id="adsCount">0</span><label>ƒ∞zl…ôn…ôn</label></div>
        <div class="stat"><span>75</span><label>Maksimum</label></div>
      </div>
      <div class="progress"><div class="progress-fill" id="progress"></div></div>
      <p style="margin-top:6px;">ƒ∞r…ôlil…ôyi≈ü: <span id="progressText">0/75</span></p>
      <button id="adBtn" class="ad-btn">‚ñ∂ ƒ∞ndi izl…ô</button>
      <div id="msg"></div>
    </div>
  </div>

  <!-- G√∂r…ôvl…ôr -->
  <div id="tasksPage" class="page">
    <div class="task-card">
      <h2>üéØ G√ºnd…ôlik Tap≈üƒ±rƒ±q</h2>
      <p>Kanala qo≈üul v…ô 0.05 ‚Çº bonus qazan!</p>
      <button id="joinBtn">Kanala Qo≈üul</button>
    </div>
  </div>

  <!-- Referans -->
  <div id="refsPage" class="page">
    <div class="ref-card">
      <h2>üë• Referans Sistemi</h2>
      <p>D…ôv…ôt etdikc…ô qazanƒ±n! H…ôr dost √º√ß√ºn <b>0.10 ‚Çº</b></p>
      <div style="background:rgba(255,255,255,0.1);padding:10px;border-radius:10px;margin-top:15px;">
        <b>Sizin linkiniz:</b><br>
        <small id="refLink" style="word-break:break-all;display:block;margin-top:6px;"></small>
        <button id="copyRef" style="margin-top:10px;padding:6px 12px;border:none;border-radius:8px;background:#3b82f6;color:#fff;font-weight:600;">Kopyala</button>
        <div id="copyMsg" class="copy-msg">Kopyalandƒ± ‚úÖ</div>
      </div>
      <p style="margin-top:10px;">D…ôv…ôt sayƒ±: <b id="refCount">0</b></p>
    </div>
  </div>

</div>

<div class="menu">
  <button onclick="showPage('adsPage',this)" class="active">üè† Reklam</button>
  <button onclick="showPage('tasksPage',this)">üéØ G√∂r…ôvl…ôr</button>
  <button onclick="showPage('refsPage',this)">üë• Referans</button>
</div>

<!-- -------------------------
  Firebase + Referans Script
  ------------------------- -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

  // --- Firebase config (senin verdiƒüin) ---
  const firebaseConfig = {
    apiKey: "AIzaSyD0dnb927FbT2LjZf06hxB6lBX2JaBdevc",
    authDomain: "qazanc-az-64da7.firebaseapp.com",
    projectId: "qazanc-az-64da7",
    storageBucket: "qazanc-az-64da7.firebasestorage.app",
    messagingSenderId: "1069574349445",
    appId: "1:1069574349445:web:b815928eca716f89617fec",
    measurementId: "G-Y5ZHFYLGMC"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // --- Telegram Mini App veya URL'den UID/startapp yakalama ---
  const tg = window.Telegram?.WebApp;
  if (tg) tg.expand();

  // start_param is preferred (Telegram passes startapp/start_param depending on setup)
  const startParam = tg?.initDataUnsafe?.start_param || null;

  // Also accept URL param fallback for direct web testing:
  const urlParams = new URLSearchParams(window.location.search);
  const urlStart = urlParams.get('startapp') || urlParams.get('ref') || null;

  // Final invitedBy (davet edenin UID) comes from either startParam (Telegram) or urlStart
  const invitedBy = startParam || urlStart || "";

  // Determine current user's UID:
  // In Telegram Mini App we expect initDataUnsafe.user.id; otherwise fallback to a test id (for browser testing)
  const currentUserId = (tg?.initDataUnsafe?.user?.id ? String(tg.initDataUnsafe.user.id) : null) || (urlParams.get('uid') || "test_user_" + String(Math.floor(Math.random()*1000000)));

  // ---------------------
  // Firestore helper functions
  // ---------------------
  const usersCollection = (uid) => doc(db, "users", uid);

  async function createIfNotExists(uid, invitedByForUser) {
    const uRef = usersCollection(uid);
    const snap = await getDoc(uRef);
    if (!snap.exists()) {
      // create user doc, give starting balance 0 (we'll not auto-give extra except if you want initial welcome)
      await setDoc(uRef, {
        balance: 0,
        invited_by: invitedByForUser || "",
        referral_count: 0
      });
      // if invitedByForUser present, reward inviter
      if (invitedByForUser) {
        const invRef = usersCollection(invitedByForUser);
        // Use update with increment if exists, but if not exists create inviter with initial values then increment
        try {
          await updateDoc(invRef, {
            referral_count: increment(1),
            balance: increment(0.1)
          });
        } catch (e) {
          // inviter doc didn't exist ‚Äî create it with the bonus
          await setDoc(invRef, {
            balance: 0.1,
            invited_by: "",
            referral_count: 1
          });
        }
      }
    }
  }

  // get user data
  async function getUserData(uid) {
    const uRef = usersCollection(uid);
    const snap = await getDoc(uRef);
    if (snap.exists()) return snap.data();
    return null;
  }

  // increment user's balance atomically
  async function addBalance(uid, amount) {
    const uRef = usersCollection(uid);
    try {
      await updateDoc(uRef, { balance: increment(amount) });
    } catch (e) {
      // if update fails because doc not exists, create then update
      await setDoc(uRef, { balance: amount, invited_by: "", referral_count: 0 }, { merge: true });
    }
  }

  // set a numeric field (used when syncing local->server)
  async function setBalance(uid, amount) {
    const uRef = usersCollection(uid);
    await updateDoc(uRef, { balance: amount }).catch(async ()=> {
      await setDoc(uRef, { balance: amount, invited_by: "", referral_count: 0 }, { merge:true });
    });
  }

  // ---------------------
  // Initialize user on load
  // ---------------------
  (async function init() {
    // create user if not exists and reward inviter
    await createIfNotExists(currentUserId, invitedBy);

    // load data to UI
    const data = await getUserData(currentUserId);
    if (data) {
      // show balance
      const balEl = document.getElementById('balance');
      const usdEl = document.getElementById('usd');
      const refCountEl = document.getElementById('refCount');
      if (balEl) balEl.textContent = Number(data.balance || 0).toFixed(4);
      if (usdEl) usdEl.textContent = (Number(data.balance || 0) * 0.59).toFixed(2);
      if (refCountEl) refCountEl.textContent = data.referral_count || 0;
    }

    // Fill ref link
    const refLinkEl = document.getElementById('refLink');
    const refUrl = `https://t.me/reklampaybot?startapp=${currentUserId}`;
    if (refLinkEl) refLinkEl.innerText = refUrl;
  })();

  // Expose helper to main (legacy) script: add to balance both locally and in Firestore
  window._qazanc_addBalance = async function(amount) {
    // update firestore
    await addBalance(currentUserId, amount);
    // update UI from server
    const newData = await getUserData(currentUserId);
    if (newData) {
      const balEl = document.getElementById('balance');
      const usdEl = document.getElementById('usd');
      if (balEl) balEl.textContent = Number(newData.balance || 0).toFixed(4);
      if (usdEl) usdEl.textContent = (Number(newData.balance || 0) * 0.59).toFixed(2);
    }
    // return updated data
    return newData;
  };

  // Expose setter to sync local change to server (used by withdraw etc.)
  window._qazanc_setBalance = async function(amount) {
    await setBalance(currentUserId, amount);
    const newData = await getUserData(currentUserId);
    if (newData) {
      const balEl = document.getElementById('balance');
      const usdEl = document.getElementById('usd');
      if (balEl) balEl.textContent = Number(newData.balance || 0).toFixed(4);
      if (usdEl) usdEl.textContent = (Number(newData.balance || 0) * 0.59).toFixed(2);
    }
    return newData;
  };

  // Expose currentUserId for other scripts if needed
  window._qazanc_currentUserId = currentUserId;

</script>

<!-- -------------------------
  Orijinal site script (korunmu≈ü) ‚Äî k√º√ß√ºk entegrasyonlarla Firestore'a baƒülandƒ±lar
  ------------------------- -->
<script>
/* -------------------------
   Orijinal kodun saf hali (senin g√∂nderdiƒüin) korunmu≈ütur.
   Sadece a≈üaƒüƒ±daki yerlere k√º√ß√ºk dokunu≈ü yapƒ±ldƒ±:
   - Reklam / join butonlarƒ± bakiye g√ºncellerken hem localStorage hem Firestore'a yazacak.
   - Withdraw (√ßƒ±xarƒ±≈ü) i≈ülemi bakiyeyi local'den d√º≈ü√ºp Firestore'a senkronlayacak.
   - Referans kopyalama butonu orijinal tasarƒ±ma eklendi.
   ------------------------- */

const LIMIT=75,REWARD=0.0020;
const BAL_KEY='bal',COUNT_KEY='cnt',RESET_KEY='resetTime',JOIN_KEY='joined';

function safeGet(k,d=0){try{return JSON.parse(localStorage.getItem(k))??d;}catch{return d;}}
function safeSet(k,v){try{localStorage.setItem(k,JSON.stringify(v));}catch(e){document.cookie=k+"="+encodeURIComponent(v)+";max-age=31536000;path=/";}}

let bal=parseFloat(safeGet(BAL_KEY,0));
let cnt=parseInt(safeGet(COUNT_KEY,0));
let resetTime=safeGet(RESET_KEY,null);

function getNextResetTime(){
  const now=new Date();
  const reset=new Date();
  reset.setUTCHours(19,0,0,0);
  if(now.getTime()>reset.getTime()) reset.setDate(reset.getDate()+1);
  return reset.getTime();
}

if(!resetTime||Date.now()>resetTime){
  cnt=0;
  resetTime=getNextResetTime();
  safeSet(RESET_KEY,resetTime);
  safeSet(COUNT_KEY,cnt);
}

function update(){
  document.getElementById('balance').textContent=bal.toFixed(4);
  document.getElementById('usd').textContent=(bal*0.59).toFixed(2);
  document.getElementById('balance2')?.textContent=bal.toFixed(4);
  document.getElementById('usd2')?.textContent=(bal*0.59).toFixed(2);
  document.getElementById('adsCount').textContent=cnt;
  document.getElementById('progress').style.width=(cnt/LIMIT*100)+'%';
  document.getElementById('progressText').textContent=`${cnt}/${LIMIT}`;
  safeSet(BAL_KEY,bal);safeSet(COUNT_KEY,cnt);
}
update();

/* ---- Reklam butonu ----
   Orijinal davranƒ±≈ü korunur: localStorage bazlƒ± saya√ß ve g√∂rsel geri bildirim.
   Ancak kazan√ß Firestore'a da eklenecek (0.0020 AZN).
*/
const adBtn=document.getElementById('adBtn'),msg=document.getElementById('msg');
adBtn.onclick=()=>{
  if(cnt>=LIMIT){msg.textContent='üì£ G√ºnd…ôlik limit…ô √ßatdƒ±nƒ±z!';return;}
  try{if(typeof show_10024800==='function')show_10024800();}catch(e){}
  adBtn.disabled=true;msg.textContent='ƒ∞zl…ônir...';
  setTimeout(async ()=>{
    // local update
    bal+=REWARD;cnt++;update();
    msg.textContent='‚úÖ +0.0020 ‚Çº …ôlav…ô olundu!';
    // firestore update
    try{
      if(window._qazanc_addBalance) await window._qazanc_addBalance(REWARD);
    }catch(e){
      console.warn("Firestore reklam balan√ß g√ºncellenemedi:",e);
    }
    let s=8;const t=setInterval(()=>{msg.textContent=`‚è≥ ${s--}s g√∂zl…ôyin`;if(s<0){clearInterval(t);adBtn.disabled=false;msg.textContent='';}},1000);
  },2500);
};

/* ---- Join (task) butonu ----
   Orijinal davranƒ±≈ü korunur (localStorage). Bonus 0.05 AZN.
   Also sync to Firestore.
*/
const joinBtn=document.getElementById('joinBtn');
if(localStorage.getItem(JOIN_KEY)){joinBtn.textContent='‚úÖ Bonus alƒ±ndƒ±!';joinBtn.disabled=true;}
joinBtn.onclick= async ()=>{
  if(localStorage.getItem(JOIN_KEY))return;
  bal+=0.05;safeSet(BAL_KEY,bal);localStorage.setItem(JOIN_KEY,'1');
  // sync to Firestore
  try{ if(window._qazanc_addBalance) await window._qazanc_addBalance(0.05); } catch(e){console.warn("Firestore join sync failed",e); }
  joinBtn.textContent='‚úÖ Bonus alƒ±ndƒ±!';joinBtn.disabled=true;
  window.open('https://t.me/qazancazicmasi','_blank');
  update();
};

/* ---- C√ºzdan / √áƒ±xarƒ±≈ü mantƒ±ƒüƒ± ----
   Orijinal olarak √ßekim i≈ülemi sadece local'da bakiye d√º≈ü√ºr√ºp bildirim veriyordu.
   Buraya Firestore sync ekledim: bakiye d√º≈üt√ºk√ße servera da setBalance √ßaƒürƒ±lƒ±r.
*/
const methods=document.querySelectorAll('.method');
const form=document.getElementById('form');const details=document.getElementById('details');
const amount=document.getElementById('amount');const alertBox=document.getElementById('alert');
let type='';
const min={m10:3,azercell:3,bakcell:3,nar:3,bank:3,usdt:17};
const ph={m10:'10 r…ôq…ômli n√∂mr…ô',azercell:'050xxxxxxx',bakcell:'055xxxxxxx',nar:'070xxxxxxx',bank:'16 r…ôq…ômli kart n√∂mr…ôsi',usdt:'TON adresi'};
if(methods) methods.forEach(m=>m.onclick=()=>{type=m.dataset.type;document.getElementById('methods').style.display='none';form.style.display='block';details.placeholder=ph[type];});
document.getElementById('backBtn')?.addEventListener('click',()=>{form.style.display='none';document.getElementById('methods').style.display='grid';});
document.getElementById('withdrawBtn')?.addEventListener('click', async ()=>{
  const det=details.value.trim();const amt=parseFloat(amount.value);
  alertBox.style.display='none';
  if(!type){showErr('Metod se√ßin');return;}
  if(!det){showErr('Detallarƒ± daxil edin');return;}
  if(isNaN(amt)||amt<=0){showErr('M…ôbl…ôƒüi d√ºzg√ºn daxil edin');return;}
  if(amt<min[type]){showErr(`Minimum m…ôbl…ôƒü ${min[type]} AZN`);return;}
  if(amt>bal){showErr('Balans kifay…ôt etmir');return;}
  bal-=amt;safeSet(BAL_KEY,bal);update();
  // sync server
  try{ if(window._qazanc_setBalance) await window._qazanc_setBalance(bal); } catch(e){console.warn("Firestore withdraw sync failed",e); }
  alertBox.textContent='‚úÖ √áƒ±xarƒ±≈ü g√∂nd…ôrildi!';alertBox.className='alert success';alertBox.style.display='block';
  setTimeout(()=>{form.style.display='none';document.getElementById('methods').style.display='grid';},1500);
});
function showErr(t){alertBox.textContent=t;alertBox.className='alert error';alertBox.style.display='block';}

/* ---- Referans kopyalama ----
   Kopyala d√ºƒümesine dokunulduƒüunda panoya kopyala ve bildirim g√∂ster.
*/
document.getElementById('copyRef').addEventListener('click', async ()=>{
  const refText = document.getElementById('refLink').innerText || (`https://t.me/reklampaybot?startapp=${window._qazanc_currentUserId || 'test_user'}`);
  try {
    await navigator.clipboard.writeText(refText);
    const msg = document.getElementById('copyMsg');
    msg.style.display = 'block';
    setTimeout(()=> msg.style.display='none',1500);
  } catch (e) {
    alert('Kopyalama uƒüursuz oldu. Brauzer kopyalama d…ôst…ôyi lazƒ±mdƒ±r.');
  }
});

/* ---- Sayfa g√∂r√ºn√ºm√º fonksiyonu (orijinal) ---- */
function showPage(id,btn){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.menu button').forEach(b=>b.classList.remove('active'));
  if(btn) btn.classList.add('active');
}

/* ---- Firestore realtime sync (listen) ----
   Eƒüer dok√ºmant dinlenmesi istersen, add snapshot listener ‚Äî fakat
   eski kod localStorage ile √ßalƒ±≈ütƒ±ƒüƒ± i√ßin burada sadece UI g√ºncelleme yapƒ±yoruz.
   (ƒ∞stersen ger√ßek-time listener ekleyebilirim)
*/
(async function listenServerBalance(){
  // try to add realtime listener (best-effort)
  try{
    const uid = window._qazanc_currentUserId;
    if(uid){
      const dbModule = window.firebaseFirestoreModule; // not used, but reser
